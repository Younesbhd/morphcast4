(window.webpackJsonpCY=window.webpackJsonpCY||[]).push([[15],{41:function(t,e,n){"use strict";n.r(e);var r=n(3),a=n.n(r),i=n(0),s=n.n(i),u=n(1),o=n.n(u),l=n(2),c=n.n(l),h=n(52),f=n(4),p=n(58),m=n(60),v=n(51),_=function(){function t(e){s()(this,t),this._defaultInterval=e,this.lastIntervalMs=e}return o()(t,[{key:"update",value:function(t){var e,n=t-this.lastTimestamp;return e=!this.lastTimestamp||n<0?this._defaultInterval:n,this.lastTimestamp=t,this.lastIntervalMs=e,e}}]),t}(),d=function(){function t(e){var n=e.rise_alphaAt10Fps,r=e.fall_alphaAt10Fps;s()(this,t),this.lastEma=null,this.alphaCalcUp=new p.a(n),this.alphaCalcDown=new p.a(r)}return o()(t,[{key:"next",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=this.alphaCalcUp.update(e),r=this.alphaCalcDown.update(e),a=t>=this.lastEma?n:r;return null!==this.lastEma?this.lastEma=a*t+(1-a)*this.lastEma:this.lastEma=t,this.lastEma}},{key:"reset",value:function(){this.lastEma=0}}]),t}(),y=function(){function t(e){var n=e.minRestTime,r=e.conf,a=e.delay;s()(this,t),this._minRestTimeHelper=new h.a(n,f.a),this._noFaceCb=null,this._timeoutCalculator=new _(a),this._arousalGain=r.arousalGain||3,this._posePower=r.posePower||7,this._maxYaw=r.maxYaw||.25,this._gain=r.gain||1.2,this._clipFilter=new m.a({boundAt10Fps:.1,windowLength:3}),this.setSmoothness(r.smoothness,r.riseSmoothness,r.fallSmoothness),this._finalGain=r.finalGain||1}var e;return o()(t,[{key:"setSmoothness",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.83,e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;this._useTimeFilters=0!==t;var r=1-(null!=e?e:t),a=1-(null!=n?n:t);this._lerp=new d({rise_alphaAt10Fps:r,fall_alphaAt10Fps:a})}},{key:"process",value:function(t){var e=this,n=t.allData,r=t.frameTimestamp;if(0===Object(v.a)({allData:n},"face_detector",f.d).faces.length)return this.processNoFace({frameTimestamp:r});var a=r;this._timeoutCalculator.update(a);var i=Object(v.a)({allData:n},"face_pose",f.d).private.rawPose,s=Object(v.a)({allData:n},"face_arousal_valence",f.d).private.rawArousalvalence.arousal;return this._minRestTimeHelper.scheduleNext((function(){var t,n,r=e._attentionMetric(i,s),u=e._clipFilter.next(r,a),o=e._useTimeFilters?u:r,l=e._lerp.next(o,a);return{type:"face_attention",output:{attention:(t=l,n=e._finalGain,Math.max(0,Math.min(1,t*n)))}}}))}},{key:"processNoFace",value:(e=a()(c.a.mark((function t(e){var n,r,a,i;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.frameTimestamp,r=this._clipFilter.next(0,n),a=this._useTimeFilters?r:0,i=this._lerp.next(a,n),t.abrupt("return",{type:"face_attention",output:{attention:i}});case 6:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"_attentionMetric",value:function(t,e){var n=t.yaw,r=Math.pow(this._maxYaw,this._posePower),a=1+Math.max(-1,Math.min(0,e*this._arousalGain)),i=Math.abs(n),s=Math.max(0,1-Math.pow(i,this._posePower)/r)*a*this._gain;return Math.min(1,Math.max(0,s))}},{key:"terminate",value:function(){clearInterval(this._noFaceCb)}},{key:"stop",value:function(){clearInterval(this._noFaceCb)}}]),t}();e.default=y},51:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(4);function a(t,e){var n=t.allData,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.d,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(t){return t},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){return!0},u=n.find((function(t){return t.type===e}));if(u){var o=i(u);if(null!=o&&s(u,o))return o}throw a}},52:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var r=n(0),a=n.n(r),i=n(1),s=n.n(i),u=function(){function t(e,n){a()(this,t),this._minRestTime=e,this._lastDoneTime=0,this._canSchedule=!0,this._busyReject=n}return s()(t,[{key:"remainingMs",value:function(){return Math.max(0,this._minRestTime-(Date.now()-this._lastDoneTime))}},{key:"canSchedule",value:function(){return this._canSchedule&&0===this.remainingMs()}},{key:"scheduleNext",value:function(t){var e=this;return this.canSchedule()?(this._canSchedule=!1,Promise.resolve(t()).then((function(t){return e.processDone(),t})).catch((function(t){throw e.processDone(),t}))):Promise.reject(this._busyReject)}},{key:"processDone",value:function(){this._canSchedule=!0,this._lastDoneTime=Date.now()}}]),t}()},53:function(t,e,n){var r=n(57);function a(){return"undefined"!=typeof Reflect&&Reflect.get?(t.exports=a=Reflect.get,t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=a=function(t,e,n){var a=r(t,e);if(a){var i=Object.getOwnPropertyDescriptor(a,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},t.exports.__esModule=!0,t.exports.default=t.exports),a.apply(this,arguments)}t.exports=a,t.exports.__esModule=!0,t.exports.default=t.exports},57:function(t,e,n){var r=n(5);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t},t.exports.__esModule=!0,t.exports.default=t.exports},58:function(t,e,n){"use strict";n.d(e,"a",(function(){return _})),n.d(e,"b",(function(){return x})),n.d(e,"c",(function(){return k})),n.d(e,"d",(function(){return T}));var r=n(53),a=n.n(r),i=n(8),s=n.n(i),u=n(9),o=n.n(u),l=n(5),c=n.n(l),h=n(0),f=n.n(h),p=n(1),m=n.n(p);function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c()(t);if(e){var a=c()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return o()(this,n)}}var _=function(){function t(e){if(f()(this,t),!e||e<0||e>1)throw new TypeError("Bad or more arguments needed");this._alphaAt10Fps=e,this._lastTimestampMs=null}return m()(t,[{key:"alphaAt10Fps",get:function(){return this._alphaAt10Fps}},{key:"lastTimestampMs",get:function(){return this._lastTimestampMs}},{key:"update",value:function(e){var n,r=e-this._lastTimestampMs;if(null===this._lastTimestampMs||r>=t.MAX_PERIOD_ALLOWED_MS)n=1;else{if(r<0||isNaN(e))throw new TypeError("Missing or bad timestamp during push (not an integer or antecedent to the one stored). Stored timestamp: "+this._lastTimestampMs+", pushed: "+e);n=t._computeAlpha(this._alphaAt10Fps,r)}return this._lastTimestampMs=e,n}}],[{key:"MAX_PERIOD_ALLOWED_MS",get:function(){return 1e3}},{key:"_computeAlpha",value:function(t,e){var n=e/1e3,r=Math.pow(1-t,10);return 1-Math.pow(r,n)}}]),t}(),d=m()((function t(e,n){var r=this;if(f()(this,t),(this instanceof t?this.constructor:void 0)===e||(this instanceof t?this.constructor:void 0)===t)throw new TypeError("Cannot construct abstract instances directly");n.forEach((function(t){if("function"!=typeof r[t])throw new TypeError("Must override method "+t)}))})),y=function(t){s()(n,t);var e=v(n);function n(){return f()(this,n),e.call(this,n,["push"])}return m()(n)}(d),w=function(t){s()(n,t);var e=v(n);function n(){var t;return f()(this,n),(t=e.call(this))._lastValue=null,t}return m()(n,[{key:"value",get:function(){return this._lastValue}},{key:"push",value:function(t){this._lastValue=t}}]),n}(y),g=function(t){s()(n,t);var e=v(n);function n(){var t;return f()(this,n),(t=e.call(this))._lastEma=null,t}return m()(n,[{key:"ema",get:function(){return this._lastEma}},{key:"push",value:function(t,e){if(null===this._lastEma)this._lastEma=t;else{if(isNaN(e))throw TypeError("Bad or missing alpha argument.");this._lastEma=(1-e)*this._lastEma+e*t}}}]),n}(y),M=function(t){s()(n,t);var e=v(n);function n(){var t;return f()(this,n),(t=e.call(this))._lastEmvar=null,t}return m()(n,[{key:"emvar",get:function(){return this._lastEmvar}},{key:"push",value:function(t,e){var r=t-this.ema;return a()(c()(n.prototype),"push",this).call(this,t,e),null===this._lastEmvar?(this._lastEmvar=0,this._lastEmvar):(this._lastEmvar=(1-e)*(this._lastEmvar+e*Math.pow(r,2)),this._lastEmvar)}}]),n}(g),E=function(t){s()(n,t);var e=v(n);function n(){return f()(this,n),e.call(this,n,["next"])}return m()(n)}(d),x={EMA:Symbol("ema"),EMVAR:Symbol("emvar"),NONE:Symbol("none")},k=function(t){s()(n,t);var e=v(n);function n(t){var r,a=t.type,i=void 0===a?x.EMVAR:a,s=t.alphaAt10Fps;switch(f()(this,n),r=e.call(this),i){case x.EMA:case x.EMVAR:r._processor=new M,r._alphaCalculator=new _(s);break;case x.NONE:r._processor=new w,r._alphaCalculator={update:function(){return null}};break;default:throw new TypeError("Not implemented")}return r._type=i,r}return m()(n,[{key:"next",value:function(t,e){var n=this._alphaCalculator.update(e);switch(this._processor.push(t,n),this._type){case x.EMVAR:return this._processor.emvar;case x.EMA:return this._processor.ema;case x.NONE:return this._processor.value}}},{key:"statistics",get:function(){return this._processor}}]),n}(E),T=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:x.NONE};f()(this,t),this._filters=new Array(e);for(var r=0;r<e;r++)this._filters[r]=new k(n)}return m()(t,[{key:"next",value:function(t,e){if(t.length!==this._filters.length)throw new TypeError("Wrong length of array in input.");return this._filters.map((function(n,r){return n.next(t[r],e)}))}}]),t}()},59:function(t,e,n){"use strict";n.d(e,"a",(function(){return _}));var r=n(8),a=n.n(r),i=n(9),s=n.n(i),u=n(5),o=n.n(u),l=n(0),c=n.n(l),h=n(1),f=n.n(h);function p(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=o()(t);if(e){var a=o()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return s()(this,n)}}function m(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=v(t),r=t.map((function(t){var e=t-n;return e*e})),a=r.reduce((function(t,e){return t+e}),0);return a/=r.length-e,Math.sqrt(a)}function v(t){return t.reduce((function(t,e){return t+e}),0)/t.length}var _=function(t){a()(n,t);var e=p(n);function n(){return c()(this,n),e.apply(this,arguments)}return f()(n,[{key:"avg",value:function(){if(0===this.length)throw new TypeError("Window is empty. Cannot compute average.");return v(this._queue)}},{key:"stddev",value:function(){if(0===this.length)throw new TypeError("Window is empty. Cannot compute standard deviation.");return m(this._queue)}},{key:"sample_stddev",value:function(){if(0===this.length)throw new TypeError("Window is empty. Cannot compute standard deviation.");if(1===this.length)throw new RangeError("Cannot estimate sample standard deviation for only one value.");return m(this._queue,1)}}]),n}(function(){function t(e){if(c()(this,t),!Number.isInteger(e)||e<1)throw new RangeError("Maximum window size must be an integer greater than zero.");this._maxLen=e,this._queue=[]}return f()(t,[{key:"enqueue",value:function(t){if(this._queue.unshift(t),this._queue.length>this._maxLen)return this._queue.pop()}},{key:"length",get:function(){return this._queue.length}}]),t}())},60:function(t,e,n){"use strict";n.d(e,"a",(function(){return y}));var r=n(0),a=n.n(r),i=n(1),s=n.n(i),u=n(53),o=n.n(u),l=n(8),c=n.n(l),h=n(9),f=n.n(h),p=n(5),m=n.n(p);function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=m()(t);if(e){var a=m()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return f()(this,n)}}var _=function(t){c()(n,t);var e=v(n);function n(t){var r,i=t.windowLength,s=void 0===i?3:i;return a()(this,n),(r=e.call(this,s))._maxWindowLength=s,r}return s()(n,[{key:"push",value:function(t,e){var r;return r=this._isWindowFull()?n._clippingValue(t,this.avg(),e):t,o()(m()(n.prototype),"enqueue",this).call(this,r),r}},{key:"_isWindowFull",value:function(){return o()(m()(n.prototype),"length",this)>=this._maxWindowLength}}],[{key:"_clippingValue",value:function(t,e,n){var r=e-n,a=e+n;return Math.min(Math.max(t,r),a)}}]),n}(n(59).a),d=function(){function t(e){a()(this,t),this.boundAt10Fps=e,this.lastTimestampMs=null}return s()(t,[{key:"update",value:function(t){var e,n=t-this.lastTimestampMs;if(null===this.lastTimestampMs)e=this.boundAt10Fps;else{if(n<0||isNaN(t))throw new TypeError("Missing or bad timestamp during push (not an integer or antecedent to the one stored). Stored timestamp: "+this.lastTimestampMs+", pushed: "+t);e=this.boundAt10Fps*n/100}return this.lastTimestampMs=t,e}}]),t}(),y=function(){function t(e){var n=e.boundAt10Fps,r=e.windowLength;a()(this,t),this._clippingFilter=new _({windowLength:r}),this._boundCalculator=new d(n)}return s()(t,[{key:"next",value:function(t,e){var n=this._boundCalculator.update(e);return this._clippingFilter.push(t,n)}}]),t}()}}]);